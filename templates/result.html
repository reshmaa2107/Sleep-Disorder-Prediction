<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analysis Result</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background: #E0F2FE; display: flex; justify-content: center; padding: 20px; }
        .result-container { background: white; border-radius: 24px; padding: 40px; width: 100%; max-width: 800px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); }
        
        .header-badge { text-align: center; margin-bottom: 30px; }
        .badge { padding: 15px 40px; border-radius: 50px; color: white; font-weight: bold; font-size: 2rem; display: inline-block; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .bg-Healthy { background-color: #34D399; } /* Green */
        .bg-Insomnia { background-color: #F87171; } /* Red */
        .bg-Sleep { background-color: #FBBF24; } /* Orange (Apnea) */

        .info-box { background: #F3F4F6; padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 5px solid #8B5CF6; }
        .healthy-box { background: #ECFDF5; border-left: 5px solid #34D399; text-align: center; padding: 30px; }
        
        h3 { color: #4B5563; margin-top: 0; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn { padding: 12px 20px; border-radius: 8px; text-decoration: none; font-weight: bold; flex: 1; text-align: center; border: none; cursor: pointer; }
        .btn-download { background: #3B82F6; color: white; }
        .btn-back { background: #E5E7EB; color: #374151; }
        
        .disclaimer { margin-top: 30px; padding: 15px; background: #FEF2F2; border: 1px solid #FCA5A5; color: #B91C1C; font-size: 0.85rem; text-align: center; border-radius: 8px; font-weight: 600; }

        .feedback-section { margin-top: 40px; border-top: 1px dashed #ccc; padding-top: 20px; }
    </style>
</head>
<body>

<div class="result-container">
    <div class="header-badge">
        <div class="badge bg-{{ prediction.split(' ')[0] }}">
            {{ details.title }}
        </div>
    </div>

    {% if details.is_bad %}
        <div class="info-box">
            <h3>üîç Definition</h3>
            <p>{{ details.desc }}</p>
        </div>

        <div class="info-box" style="border-left-color: #EC4899;">
            <h3>‚ö†Ô∏è Potential Causes</h3>
            <p>{{ details.cause }}</p>
        </div>

        <div class="info-box" style="border-left-color: #10B981;">
            <h3>üõ°Ô∏è Recommended Remedy</h3>
            <p>{{ details.remedy }}</p>
        </div>
    {% else %}
        <div class="healthy-box">
            <h3 style="color: #059669;">‚ú® Fantastic Job! ‚ú®</h3>
            <p style="font-size: 1.1rem;">{{ details.desc }}</p>
            <p style="color: #6B7280; font-style: italic; margin-top: 15px;">"{{ details.action }}"</p>
        </div>
    {% endif %}
    <div style="height: 300px; margin-top: 30px;">
        <canvas id="resultChart"></canvas>
    </div>

    <div class="disclaimer">
        üö® <strong>NOTE:</strong> This result is generated by an Artificial Intelligence model based on your inputs. 
        It is <u>NOT</u> a medical diagnosis. If you feel unwell, please consult a certified doctor immediately.
    </div>

    <div class="btn-group">
        <a href="/" class="btn btn-back">Try Again</a>
        <a href="/download_report" class="btn btn-download">üìÑ Download PDF Report</a>
    </div>

    <div class="feedback-section">
        <h4>Was this analysis helpful?</h4>
        <select id="fbRating" style="padding: 10px; border-radius: 8px; width: 100%; margin-bottom: 10px;">
            <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Excellent)</option>
            <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (Good)</option>
            <option value="3">‚≠ê‚≠ê‚≠ê (Average)</option>
            <option value="2">‚≠ê‚≠ê (Poor)</option>
        </select>
        <textarea id="fbMessage" rows="3" style="width: 100%; padding: 10px; border-radius: 8px;" placeholder="Leave a comment..."></textarea>
        <button onclick="sendFeedback()" class="btn btn-download" style="margin-top: 10px; background: #6B7280;">Submit Feedback</button>
    </div>
</div>

<script>
    const ctx = document.getElementById('resultChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Your Night Screen Time', 'Rec. Limit (1 hr)', 'Your Stress', 'Avg Stress (4)'],
            datasets: [{
                label: 'Your Health Metrics',
                data: ["{{ form_data['night_screen'] }}", 1.0, "{{ form_data['stress'] }}", 4],
                backgroundColor: ['#F87171', '#34D399', '#FBBF24', '#34D399']
            }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    async function sendFeedback() {
        const rating = document.getElementById('fbRating').value;
        const message = document.getElementById('fbMessage').value;
        if(!message) { alert("Please write a message!"); return; }
        
        const response = await fetch('/submit_feedback', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ rating: rating, message: message })
        });
        alert("Thanks for your feedback!");
    }
</script>

</body>
</html>